<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
<title>Woordenschat Quiz ‚Äî B1‚ÄìB2 Nederlands</title>
<meta name="description" content="Oefen B1‚ÄìB2 woordenschat met contextrijke meerkeuzevragen. Raad de betekenis op basis van voorbeeldzinnen.">
<meta name="theme-color" content="#0F1117">
<meta name="color-scheme" content="dark">
<meta property="og:title" content="Woordenschat Quiz ‚Äî B1‚ÄìB2">
<meta property="og:description" content="Oefen B1‚ÄìB2 woordenschat met contextrijke meerkeuzevragen. Geen vertalingen ‚Äî raad de betekenis zelf.">
<meta property="og:type" content="website">
<link rel="manifest" href="site.webmanifest">

<style>
/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   DESIGN TOKENS
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{
  --bg:#0F1117;
  --surface:#181A20;
  --surface-2:#1E2028;
  --surface-3:#252830;
  --ink:#E8E9ED;
  --ink-2:#A0A3AD;
  --ink-3:#6B6F7B;
  --ink-4:#3E414B;
  --border:rgba(255,255,255,0.06);
  --border-2:rgba(255,255,255,0.10);
  --border-3:rgba(255,255,255,0.16);
  --correct-bg:rgba(45,106,79,0.12);
  --correct-border:rgba(45,106,79,0.4);
  --correct-fill:#2D6A4F;
  --correct-ink:#52B788;
  --wrong-bg:rgba(196,69,54,0.12);
  --wrong-border:rgba(196,69,54,0.4);
  --wrong-fill:#C44536;
  --wrong-ink:#E8776C;
  --radius:12px;
  --radius-lg:16px;
  --font:-apple-system,BlinkMacSystemFont,'Segoe UI',system-ui,sans-serif;
  --mono:'SF Mono','Fira Code','Fira Mono','Roboto Mono',monospace;
  --hint-bg:rgba(180,190,210,0.06);
  --hint-border:rgba(180,190,210,0.12);
  --hint-bg-h:rgba(180,190,210,0.10);
  --hint-border-h:rgba(180,190,210,0.18);
  --hint-ink:rgba(180,190,210,0.85);
  --focus-ring:rgba(120,160,255,0.6);
  --ease:cubic-bezier(0.4,0,0.2,1);
  --app-w:480px;
}
html{font-size:16px;-webkit-text-size-adjust:100%;height:-webkit-fill-available}
body{font-family:var(--font);background:var(--bg);color:var(--ink);min-height:100vh;min-height:100svh;overflow-x:hidden;-webkit-font-smoothing:antialiased}
button{font-family:inherit;cursor:pointer;border:none;background:none;color:inherit}
*:focus{outline:none}
*:focus-visible{outline:2px solid var(--focus-ring);outline-offset:2px;border-radius:var(--radius)}
.theme-card:focus-visible,.option-btn:focus-visible{outline:2px solid var(--focus-ring);outline-offset:2px;box-shadow:0 0 0 4px rgba(120,160,255,0.15)}
.skip-link{position:absolute;top:-40px;left:0;background:var(--ink);color:var(--bg);padding:8px 16px;z-index:100;font-size:15px;font-weight:600;border-radius:0 0 var(--radius) 0;transition:top .2s}
.skip-link:focus{top:0}

/* ‚ïê‚ïê‚ïê‚ïê APP SHELL ‚ïê‚ïê‚ïê‚ïê */
.app{max-width:var(--app-w);margin:0 auto;min-height:100vh;min-height:100svh;display:flex;flex-direction:column}
.app>main{display:flex;flex-direction:column;flex:1;min-height:0}
#app{display:flex;flex-direction:column;flex:1;min-height:0}
@media(min-width:768px){:root{--app-w:520px}}
@media(min-width:1200px){:root{--app-w:560px}}

/* ‚ïê‚ïê‚ïê‚ïê LOADING ‚ïê‚ïê‚ïê‚ïê */
.loading{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:16px;color:var(--ink-3);font-size:16px}
.spinner{width:32px;height:32px;border:3px solid var(--surface-3);border-top-color:var(--ink-2);border-radius:50%;animation:spin .8s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}

/* ‚ïê‚ïê‚ïê‚ïê HOME ‚ïê‚ïê‚ïê‚ïê */
.home{padding:24px 20px calc(24px + env(safe-area-inset-bottom,0px));flex:1;display:flex;flex-direction:column}
.home-hd{padding:28px 0 4px}
.home-eyebrow{font-size:13px;font-weight:600;letter-spacing:1.5px;text-transform:uppercase;color:var(--ink-3);margin-bottom:8px}
.home-title{font-size:34px;font-weight:700;letter-spacing:-.5px;line-height:1.12}
.home-sub{font-size:17px;color:var(--ink-2);margin-top:10px;line-height:1.47}

/* ‚îÄ‚îÄ stats ‚îÄ‚îÄ */
.stats-bar{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin:20px 0 4px}
.stat-box{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:12px;text-align:center}
.stat-val{font-size:22px;font-weight:700;font-family:var(--mono);letter-spacing:-.5px}
.stat-lbl{font-size:11px;color:var(--ink-3);margin-top:3px;font-family:var(--mono)}

/* ‚îÄ‚îÄ theme cards ‚îÄ‚îÄ */
.sec-label{font-size:11px;font-weight:600;letter-spacing:1.5px;text-transform:uppercase;color:var(--ink-3);font-family:var(--mono);margin:20px 0 10px}
.theme-grid{display:flex;flex-direction:column;gap:8px}
.theme-card{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius-lg);display:flex;align-items:stretch;overflow:hidden;transition:all .15s var(--ease);text-align:left;width:100%;cursor:pointer}
.theme-card:hover{background:var(--surface-2);border-color:var(--border-2);transform:translateY(-1px);box-shadow:0 4px 20px rgba(0,0,0,.28)}
.theme-card:active{transform:scale(.99);box-shadow:none}
.th-accent{width:3px;flex-shrink:0}
.th-inner{flex:1;padding:13px 14px;display:flex;align-items:center;gap:14px;min-width:0}
.th-emoji{width:44px;height:44px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:22px;flex-shrink:0}
.th-info{flex:1;min-width:0}
.th-name{font-size:16px;font-weight:600;letter-spacing:-.2px;margin-bottom:2px}
.th-desc{font-size:12px;color:var(--ink-3);font-family:var(--mono);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;letter-spacing:-.2px}

/* ‚îÄ‚îÄ progress ring ‚îÄ‚îÄ */
.ring-wrap{width:38px;height:38px;position:relative;flex-shrink:0}
.ring-wrap svg{transform:rotate(-90deg)}
.ring-bg{stroke:var(--surface-3);fill:none}
.ring-fill{fill:none;stroke-linecap:round;transition:stroke-dashoffset .5s var(--ease)}
.ring-pct{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;font-size:10px;font-weight:700;font-family:var(--mono);color:var(--ink-2)}

/* ‚ïê‚ïê‚ïê‚ïê COUNT SELECT ‚ïê‚ïê‚ïê‚ïê
   Full-width on mobile, constrained by --app-w on desktop (same as rest of app)
‚ïê‚ïê‚ïê‚ïê */
.count-sel{
  flex:1;
  display:flex;
  flex-direction:column;
  align-items:center;
  padding:32px 24px calc(32px + env(safe-area-inset-bottom,0px));
  overflow-y:auto;
  -webkit-overflow-scrolling:touch;
  width:100%;
}
.count-theme-badge{
  display:inline-flex;
  align-items:center;
  gap:8px;
  font-size:15px;
  font-weight:600;
  padding:6px 14px;
  border-radius:20px;
  margin-bottom:20px;
  background:var(--surface-2);
  border:1px solid var(--border-2);
}
.count-title{font-size:24px;font-weight:700;letter-spacing:-.3px;margin-bottom:8px;text-align:center}
.count-sub{font-size:15px;color:var(--ink-2);margin-bottom:28px;text-align:center;line-height:1.5}
/* count buttons ‚Äî simple 2-col grid, no max-width clamp, fills container */
.count-grid{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:12px;
  width:100%;
}
.count-btn{
  background:var(--surface);
  border:1px solid var(--border-2);
  padding:22px 16px;
  border-radius:var(--radius-lg);
  font-size:28px;
  font-weight:700;
  font-family:var(--mono);
  color:var(--ink);
  transition:all .15s var(--ease);
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  gap:5px;
  cursor:pointer;
  letter-spacing:-.5px;
}
.count-btn span{font-size:12px;font-weight:400;color:var(--ink-3);font-family:var(--font);letter-spacing:0}
.count-btn:hover{background:var(--surface-2);border-color:var(--border-3);transform:translateY(-1px);box-shadow:0 4px 16px rgba(0,0,0,.2)}
.count-btn:active{transform:scale(.97);box-shadow:none}
.count-btn.full{grid-column:span 2;flex-direction:row;gap:10px;font-size:20px;padding:18px 20px}
.count-btn.full span{font-size:13px}
.back-btn-sm{background:var(--surface);border:1px solid var(--border-2);color:var(--ink-2);font-size:15px;padding:0 20px;height:44px;border-radius:var(--radius);display:inline-flex;align-items:center;gap:6px;margin-top:24px;transition:all .15s;cursor:pointer}
.back-btn-sm:hover{background:var(--surface-2)}

/* ‚ïê‚ïê‚ïê‚ïê QUIZ ‚ïê‚ïê‚ïê‚ïê */
.quiz{flex:1;display:flex;flex-direction:column;min-height:0;overflow:hidden}
.quiz-top{padding:16px 20px 0;flex-shrink:0}
.quiz-nav{display:flex;align-items:center;gap:12px;margin-bottom:16px}
.nav-back{width:36px;height:36px;border-radius:8px;display:flex;align-items:center;justify-content:center;background:var(--surface);border:1px solid var(--border);font-size:17px;color:var(--ink-2);transition:all .15s;cursor:pointer;flex-shrink:0}
.nav-back:hover{background:var(--surface-2)}
.quiz-theme-lbl{font-size:15px;font-weight:600;flex:1;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.quiz-ctr{font-family:var(--mono);font-size:14px;color:var(--ink-2);flex-shrink:0}
.level-badge{font-size:10px;font-weight:700;font-family:var(--mono);padding:2px 7px;border-radius:4px;letter-spacing:.5px;flex-shrink:0}
.prog-wrap{display:flex;align-items:center;gap:10px;margin-bottom:4px}
.prog-bar{flex:1;height:4px;background:var(--surface-3);border-radius:2px;overflow:hidden}
.prog-fill{height:100%;border-radius:2px;transition:width .4s var(--ease)}
.score-pills{display:flex;gap:8px}
.spill{display:flex;align-items:center;gap:4px;font-size:13px;font-weight:600;font-family:var(--mono);padding:3px 8px;border-radius:6px}
.spill.ok{background:var(--correct-bg);color:var(--correct-ink)}
.spill.no{background:var(--wrong-bg);color:var(--wrong-ink)}
.spill .dot{width:6px;height:6px;border-radius:50%}
.spill.ok .dot{background:var(--correct-ink)}
.spill.no .dot{background:var(--wrong-ink)}

/* ‚îÄ‚îÄ body ‚îÄ‚îÄ */
.quiz-body{flex:1;padding:16px 20px;display:flex;flex-direction:column;overflow-y:auto;-webkit-overflow-scrolling:touch;min-height:0;gap:14px}

/* ‚îÄ‚îÄ context panel ‚îÄ‚îÄ */
.ctx{border-radius:var(--radius);overflow:hidden;border:1px solid var(--border);background:var(--surface-2);flex-shrink:0}
.ctx-hd{padding:8px 13px;background:var(--surface-3);border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between}
.ctx-hd-lbl{font-size:10px;font-weight:700;letter-spacing:1.8px;text-transform:uppercase;font-family:var(--mono);color:var(--ink-3);display:flex;align-items:center;gap:5px}
.ctx-hd-dot{width:5px;height:5px;border-radius:50%;background:var(--ink-4)}
.ctx-hd-ct{font-size:10px;font-family:var(--mono);color:var(--ink-4)}
.ctx-ex{padding:10px 13px;font-size:14px;line-height:1.65;color:var(--ink-2);border-bottom:1px solid var(--border)}
.ctx-ex:last-of-type{border-bottom:none}
.ctx-ex mark{background:none;color:var(--ink);font-weight:600;font-style:italic}
.ctx-ex.hidden{display:none}
.ctx-num{font-size:10px;font-family:var(--mono);color:var(--ink-4);margin-right:5px}
.ctx-more{width:100%;padding:8px 13px;display:flex;align-items:center;gap:5px;font-size:12px;color:var(--ink-3);font-family:var(--mono);background:var(--surface-3);border-top:1px solid var(--border);cursor:pointer;text-align:left;transition:all .13s}
.ctx-more:hover{color:var(--ink-2);background:var(--surface-2)}
.ctx-chevron{font-size:9px;opacity:.5;transition:transform .2s var(--ease)}
.ctx-more.open .ctx-chevron{transform:rotate(180deg)}

/* ‚îÄ‚îÄ question ‚îÄ‚îÄ */
.q-lbl{font-size:10px;font-weight:700;letter-spacing:1.8px;text-transform:uppercase;font-family:var(--mono);color:var(--ink-3);margin-bottom:8px}
.q-word{font-size:26px;font-weight:700;letter-spacing:-.5px;color:var(--ink);margin-bottom:3px}
.q-pos{font-size:12px;font-family:var(--mono);color:var(--ink-3);margin-bottom:14px}

/* ‚îÄ‚îÄ options ‚îÄ‚îÄ */
.options{display:flex;flex-direction:column;gap:7px}
.option-btn{width:100%;text-align:left;padding:12px 13px;border-radius:var(--radius);background:var(--surface);border:1.5px solid var(--border);font-size:15px;line-height:1.45;display:flex;align-items:flex-start;gap:10px;transition:all .13s var(--ease);cursor:pointer;color:var(--ink)}
.option-btn:not(.locked):hover{background:var(--surface-2);border-color:var(--border-2)}
.option-btn:not(.locked):active{transform:scale(.99)}
.option-btn.locked{pointer-events:none}
.opt-key{width:24px;height:24px;border-radius:6px;display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:700;font-family:var(--mono);flex-shrink:0;background:var(--surface-3);color:var(--ink-2);margin-top:1px;transition:all .13s}
.opt-txt{padding-top:1px}
.option-btn.is-correct{background:var(--correct-bg);border-color:var(--correct-border)}
.option-btn.is-correct .opt-key{background:var(--correct-fill);color:#fff}
.option-btn.is-wrong{background:var(--wrong-bg);border-color:var(--wrong-border)}
.option-btn.is-wrong .opt-key{background:var(--wrong-fill);color:#fff}
.option-btn.show-correct{background:var(--correct-bg);border-color:var(--correct-border)}
.option-btn.show-correct .opt-key{background:var(--correct-fill);color:#fff}

/* ‚îÄ‚îÄ feedback ‚îÄ‚îÄ */
.feedback{padding:13px 14px;border-radius:var(--radius);font-size:14px;line-height:1.65;animation:fbIn .22s var(--ease)}
@keyframes fbIn{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:translateY(0)}}
.feedback.ok{background:var(--correct-bg);border:1px solid var(--correct-border)}
.feedback.no{background:var(--wrong-bg);border:1px solid var(--wrong-border)}
.fb-lbl{font-size:15px;font-weight:700;margin-bottom:5px;display:flex;align-items:center;gap:6px}
.feedback.ok .fb-lbl{color:var(--correct-ink)}
.feedback.no .fb-lbl{color:var(--wrong-ink)}
.fb-body{color:var(--ink-2)}

/* ‚îÄ‚îÄ hint ‚îÄ‚îÄ */
.hint-btn{display:inline-flex;align-items:center;justify-content:center;gap:6px;padding:13px 16px;border-radius:var(--radius);background:var(--hint-bg);border:1px solid var(--hint-border);font-size:15px;font-weight:500;color:var(--ink-3);transition:all .18s;line-height:1;flex-shrink:0;white-space:nowrap;cursor:pointer}
.hint-btn:hover:not([disabled]){background:var(--hint-bg-h);border-color:var(--hint-border-h);color:var(--hint-ink)}
.hint-btn.open{background:var(--hint-bg-h);border-color:var(--hint-border-h);color:var(--hint-ink)}
.hint-btn[disabled]{opacity:.4;cursor:not-allowed}
.h-chev{font-size:9px;margin-left:2px;opacity:.5;transition:transform .2s var(--ease)}
.hint-btn.open .h-chev{transform:rotate(180deg)}
.hint-pop{padding:13px 14px;border-radius:var(--radius);background:var(--surface-3);border:1px solid var(--border-2);font-size:14px;color:var(--ink-2);line-height:1.65;animation:fbIn .18s var(--ease);z-index:10}
.hint-pop-hd{display:flex;align-items:center;justify-content:space-between;margin-bottom:6px}
.hint-pop-lbl{font-size:11px;font-weight:700;color:var(--ink-3);font-family:var(--mono);letter-spacing:.3px;text-transform:uppercase;display:flex;align-items:center;gap:5px}
.hint-close{width:26px;height:26px;border-radius:6px;display:flex;align-items:center;justify-content:center;font-size:14px;color:var(--ink-2);background:var(--surface);border:1px solid var(--border);cursor:pointer;transition:all .13s}
.hint-close:hover{background:var(--surface-2);color:var(--ink)}
.hint-overlay{position:fixed;inset:0;z-index:9}

/* ‚îÄ‚îÄ footer ‚îÄ‚îÄ */
.quiz-foot{padding:12px 20px calc(20px + env(safe-area-inset-bottom,0px));flex-shrink:0;display:flex;flex-direction:column;gap:9px;background:var(--bg);z-index:8}
.foot-row{display:flex;gap:8px;align-items:center}
.btn-next{flex:1;padding:14px;border-radius:var(--radius);font-size:16px;font-weight:600;text-align:center;transition:all .13s var(--ease);letter-spacing:-.2px;cursor:pointer}
.btn-next.primary{background:var(--ink);color:var(--bg)}
.btn-next.primary:hover{opacity:.9}
.btn-next.primary:active{transform:scale(.98)}
.btn-next.disabled{background:var(--surface-3);color:var(--ink-3);pointer-events:none}

/* ‚ïê‚ïê‚ïê‚ïê RESULTS ‚ïê‚ïê‚ïê‚ïê */
.results{padding:24px 20px calc(24px + env(safe-area-inset-bottom,0px));flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center}
.res-emoji{font-size:64px;margin-bottom:20px;animation:pop .4s cubic-bezier(.34,1.56,.64,1)}
@keyframes pop{from{transform:scale(0)}to{transform:scale(1)}}
.res-score{font-size:56px;font-weight:700;letter-spacing:-2px;font-family:var(--mono)}
.res-lbl{font-size:17px;color:var(--ink-2);margin-top:4px}
.res-msg{font-size:16px;color:var(--ink-2);margin-top:16px;line-height:1.5;max-width:300px}
.res-stats{display:flex;gap:24px;margin-top:28px}
.rs{text-align:center}
.rs-val{font-size:28px;font-weight:700;font-family:var(--mono)}
.rs-val.g{color:var(--correct-ink)}
.rs-val.r{color:var(--wrong-ink)}
.rs-lbl{font-size:13px;color:var(--ink-3);margin-top:4px}
.res-actions{display:flex;flex-direction:column;gap:10px;width:100%;max-width:300px;margin-top:32px}
.btn-res{padding:14px;border-radius:var(--radius);font-size:16px;font-weight:600;text-align:center;transition:all .13s;letter-spacing:-.2px;cursor:pointer}
.btn-res.primary{background:var(--ink);color:var(--bg)}
.btn-res.secondary{background:var(--surface);color:var(--ink);border:1px solid var(--border)}
.btn-res.link{background:none;border:none;color:var(--ink-3);font-size:15px;font-weight:500}
.btn-res:hover{opacity:.9}
.btn-res:active{transform:scale(.98)}
.btn-res.link:hover{color:var(--ink-2)}

/* ‚ïê‚ïê‚ïê‚ïê REVIEW ‚ïê‚ïê‚ïê‚ïê */
.review{padding:20px;flex:1;overflow-y:auto}
.rev-hd{display:flex;align-items:center;gap:12px;margin-bottom:20px}
.rev-title{font-size:20px;font-weight:600}
.rev-card{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius-lg);padding:14px;margin-bottom:8px}
.rev-word{font-size:17px;font-weight:700;margin-bottom:4px}
.rev-body{font-size:14px;color:var(--ink-2);line-height:1.6}
.rev-body strong{color:var(--correct-ink);font-weight:600}
.rev-wrong{color:var(--wrong-ink)}

/* ‚ïê‚ïê‚ïê‚ïê KBD HINTS ‚ïê‚ïê‚ïê‚ïê */
.kbd-row{display:none;gap:6px;flex-wrap:wrap;justify-content:center}
.kh{display:inline-flex;align-items:center;gap:5px;font-size:12px;color:var(--ink-3);font-family:var(--mono)}
.kbd{display:inline-flex;align-items:center;justify-content:center;min-width:22px;height:20px;padding:0 5px;border-radius:4px;background:var(--surface-3);border:1px solid var(--ink-4);font-size:11px;font-weight:600;color:var(--ink-2);font-family:var(--mono)}
@media(hover:hover) and (pointer:fine){.kbd-row{display:flex}}
@media(pointer:coarse){.option-btn{padding:11px 13px;font-size:15px}.options{gap:6px}}
.sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}
</style>
</head>
<body>
<a class="skip-link" href="#main-content">Ga naar inhoud</a>
<div class="app">
  <main id="main-content">
    <div id="app" role="application">
      <div class="loading"><div class="spinner"></div><div>Laden...</div></div>
    </div>
  </main>
</div>
<div id="sr-live" class="sr-only" aria-live="polite" aria-atomic="true"></div>

<script>
/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   CONFIG ‚Äî themes registry
   Questions are lazy-loaded per theme from data/{id}.json
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
const THEMES = [
  { id:"mens-lichaam",      label:"Mens & Lichaam",          emoji:"üë§", color:"#E87F7F", description:"mens ¬∑ kind ¬∑ lichaam ¬∑ gezicht ¬∑ ziek" },
  { id:"tijd-ruimte",       label:"Tijd & Ruimte",           emoji:"üïí", color:"#5B8CFF", description:"tijd ¬∑ jaar ¬∑ vroeger ¬∑ moment ¬∑ ruimte" },
  { id:"maatschappij",      label:"Maatschappij & Wereld",   emoji:"üåç", color:"#52B788", description:"wereld ¬∑ land ¬∑ politiek ¬∑ oorlog ¬∑ recht" },
  { id:"gevoelens",         label:"Gevoelens & Gedachten",   emoji:"‚ù§Ô∏è", color:"#E09F3E", description:"denken ¬∑ voelen ¬∑ angst ¬∑ liefde ¬∑ hopen" },
  { id:"werk-studie",       label:"Werk & Studie",           emoji:"üíº", color:"#B47FE8", description:"werk ¬∑ schrijven ¬∑ school ¬∑ leren ¬∑ beroep" },
  { id:"huis-leven",        label:"Huis & Dagelijks Leven",  emoji:"üè†", color:"#5BC4E8", description:"huis ¬∑ kamer ¬∑ deur ¬∑ bed ¬∑ koken ¬∑ boodschappen" },
  { id:"communicatie",      label:"Communicatie",            emoji:"üó£Ô∏è", color:"#E8A85B", description:"zeggen ¬∑ spreken ¬∑ vragen ¬∑ antwoorden ¬∑ brief" },
  { id:"actie-beweging",    label:"Actie & Beweging",        emoji:"üèÉ", color:"#7EE8A2", description:"gaan ¬∑ komen ¬∑ brengen ¬∑ lopen ¬∑ starten" },
  { id:"eigenschappen",     label:"Eigenschappen",           emoji:"üìè", color:"#C87EE8", description:"groot ¬∑ mooi ¬∑ zwaar ¬∑ snel ¬∑ rustig ¬∑ leeg" },
  { id:"verbindingswoorden",label:"Verbindingswoorden",      emoji:"üîó", color:"#E8D85B", description:"omdat ¬∑ hoewel ¬∑ tijdens ¬∑ toch ¬∑ namelijk" },
  { id:"reizen",            label:"Reizen & Vervoer",        emoji:"‚úàÔ∏è", color:"#5B8CFF", description:"vliegtuig ¬∑ douane ¬∑ bagage ¬∑ verblijf ¬∑ toeslag" },
  { id:"school-onderwijs",  label:"School & Onderwijs",      emoji:"üìö", color:"#52B788", description:"toets ¬∑ cijfer ¬∑ stage ¬∑ herkansen ¬∑ scriptie" },
  { id:"aardrijkskunde",    label:"Aardrijkskunde",          emoji:"üó∫Ô∏è", color:"#E09F3E", description:"klimaat ¬∑ bevolking ¬∑ delta ¬∑ migratie ¬∑ evenaar" },
  { id:"werk-carriere",     label:"Werk & Carri√®re",         emoji:"üè¢", color:"#B47FE8", description:"solliciteren ¬∑ vergadering ¬∑ pensioen ¬∑ loopbaan" },
  { id:"gezondheid",        label:"Gezondheid & Lichaam",    emoji:"üè•", color:"#E87F7F", description:"symptoom ¬∑ diagnose ¬∑ herstel ¬∑ vaccin ¬∑ chronisch" },
];

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   QUESTION CACHE ‚Äî lazy loaded per theme
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
const Q_CACHE = {};

async function loadTheme(themeId) {
  if (Q_CACHE[themeId]) return Q_CACHE[themeId];
  try {
    const res = await fetch(`data/${themeId}.json`);
    if (!res.ok) throw new Error(`HTTP ${res.status}`);
    const data = await res.json();
    Q_CACHE[themeId] = data;
    return data;
  } catch(e) {
    console.error("Failed to load theme:", themeId, e);
    return [];
  }
}

function themeWordCount(themeId) {
  return Q_CACHE[themeId]?.length ?? THEMES.find(t=>t.id===themeId)?.wordCount ?? 0;
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   PROGRESS
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
const STORAGE_KEY = "wq_progress_v2";

function loadProgress() {
  try {
    const raw = localStorage.getItem(STORAGE_KEY);
    if (!raw) return {};
    const parsed = JSON.parse(raw);
    const out = {};
    for (const [k,v] of Object.entries(parsed)) {
      out[k] = { seen:new Set(v.seen||[]), correct:new Set(v.correct||[]), bestPct:v.bestPct||0, attempts:v.attempts||0 };
    }
    return out;
  } catch(e) { return {}; }
}

function saveProgress(p) {
  try {
    const s = {};
    for (const [k,v] of Object.entries(p)) {
      s[k] = { seen:[...v.seen], correct:[...v.correct], bestPct:v.bestPct, attempts:v.attempts };
    }
    localStorage.setItem(STORAGE_KEY, JSON.stringify(s));
  } catch(e) {}
}

function themePct(themeId) {
  const p = progress[themeId];
  const wc = themeWordCount(themeId);
  if (!p || !wc) return 0;
  return Math.round(p.correct.size / wc * 100);
}

function flushProgress(themeId, sessionResults) {
  if (!progress[themeId]) progress[themeId] = { seen:new Set(), correct:new Set(), bestPct:0, attempts:0 };
  const p = progress[themeId];
  p.attempts++;
  for (const r of sessionResults) {
    p.seen.add(r.word);
    if (r.isCorrect) p.correct.add(r.word);
    else p.correct.delete(r.word);
  }
  const pct = Math.round(p.correct.size / themeWordCount(themeId) * 100);
  if (pct > p.bestPct) p.bestPct = pct;
  saveProgress(progress);
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   STATE
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
let progress = loadProgress();

const INIT_STATE = {
  screen: "home",
  theme: null,
  pendingTheme: null,
  questions: [],
  qIdx: 0,
  scoreOk: 0,
  scoreBad: 0,
  answered: null,
  selectedIdx: null,
  showHint: false,
  ctxExpanded: false,
  sessionResults: [],
  wrongAnswers: [],
  showReview: false,
};
let S = { ...INIT_STATE };
let pendingFocus = null;

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   HELPERS
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
const KEYS = ["A","B","C","D"];
const KEY_MAP = {a:0,b:1,c:2,d:3,"1":0,"2":1,"3":2,"4":3};

function shuffle(arr) {
  const a=[...arr];
  for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]]}
  return a;
}
function announce(text) {
  const el=document.getElementById("sr-live");
  if(!el)return;
  el.textContent="";
  requestAnimationFrame(()=>{el.textContent=text;});
}
function esc(s) {
  if(typeof s!=="string")return s;
  const d=document.createElement("div");
  d.appendChild(document.createTextNode(s));
  return d.innerHTML;
}
function safeEx(ex) {
  return esc(ex).replace(/&lt;mark&gt;/g,"<mark>").replace(/&lt;\/mark&gt;/g,"</mark>");
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   ACTIONS
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function goHome() {
  S = {...INIT_STATE};
  pendingFocus = "theme-0";
  render();
}

async function openCountSelect(themeId) {
  S.pendingTheme = themeId;
  S.screen = "count-select";
  render(); // show screen immediately (shows loading state in count-select)
  await loadTheme(themeId); // fetch in background
  render(); // re-render with real word count
  pendingFocus = "count-10";
  requestAnimationFrame(()=>{
    const el = document.getElementById(pendingFocus);
    if(el) el.focus();
    pendingFocus = null;
  });
}

async function startQuiz(themeId, count) {
  const all = await loadTheme(themeId);
  const shuffled = shuffle(all);
  const subset = count==="all" ? shuffled : shuffled.slice(0, Math.min(count, shuffled.length));
  S = {
    ...INIT_STATE,
    screen: "quiz",
    theme: themeId,
    questions: subset,
    sessionResults: [],
  };
  pendingFocus = "option-0";
  render();
  announce("Quiz gestart. Vraag 1 van " + subset.length + ".");
}

function selectAnswer(idx) {
  if(S.answered) return;
  const q = S.questions[S.qIdx];
  const ok = idx===q.correct;
  S.answered = ok ? "ok" : "bad";
  S.selectedIdx = idx;
  S.sessionResults.push({word:q.word, isCorrect:ok});
  if(ok){S.scoreOk++;announce("Goed! "+q.explanation);}
  else{S.scoreBad++;S.wrongAnswers.push({word:q.word,selected:q.options[idx],correct:q.options[q.correct],explanation:q.explanation});announce("Fout. "+q.options[q.correct]);}
  pendingFocus = "btn-next";
  render();
  requestAnimationFrame(()=>{
    const foot = document.querySelector(".quiz-foot");
    if(foot) foot.scrollIntoView({behavior:"smooth",block:"end"});
  });
}

function nextQ() {
  const total = S.questions.length;
  if(S.qIdx >= total-1) {
    flushProgress(S.theme, S.sessionResults);
    S.screen = "results";
    pendingFocus = "btn-retry";
    render();
    announce("Quiz afgelopen. Score: "+Math.round(S.scoreOk/total*100)+"%.");
    return;
  }
  S.qIdx++;
  S.answered=null;S.selectedIdx=null;S.showHint=false;S.ctxExpanded=false;
  pendingFocus="option-0";
  render();
  announce("Vraag "+(S.qIdx+1)+".");
}

function toggleHint() {
  S.showHint = !S.showHint;
  pendingFocus = S.showHint ? "hint-close" : "hint-btn";
  render();
  if(S.showHint) announce("Aanwijzing: "+S.questions[S.qIdx].hint);
}
function toggleCtx() {S.ctxExpanded=!S.ctxExpanded;render();}
function toggleReview() {
  S.showReview=!S.showReview;
  pendingFocus=S.showReview?"rev-back":"btn-review";
  render();
}
function resetAll() {
  if(!confirm("Weet je zeker dat je alle voortgang wilt verwijderen?")) return;
  localStorage.removeItem(STORAGE_KEY);
  progress={};
  render();
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   RENDER
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function render() {
  const app = document.getElementById("app");
  const screens = {
    home: renderHome,
    "count-select": renderCountSelect,
    quiz: renderQuiz,
    results: ()=> S.showReview ? renderReview() : renderResults()
  };
  app.innerHTML = (screens[S.screen]||renderHome)();
  if(pendingFocus) {
    requestAnimationFrame(()=>{
      const el=document.getElementById(pendingFocus);
      if(el) el.focus();
      pendingFocus=null;
    });
  }
}

/* ‚îÄ‚îÄ HOME ‚îÄ‚îÄ */
function renderHome() {
  let totalSeen=0,totalCorrect=0,done=0;
  for(const t of THEMES){
    const p=progress[t.id];
    if(p){totalSeen+=p.seen.size;totalCorrect+=p.correct.size;if(themePct(t.id)===100)done++;}
  }
  const cards = THEMES.map((t,i)=>{
    const pct=themePct(t.id);
    const da=94.2;
    const off=(da*(1-pct/100)).toFixed(1);
    return `<button class="theme-card" id="theme-${i}" onclick="openCountSelect('${t.id}')" aria-label="${esc(t.label)}, ${pct}% klaar">
      <div class="th-accent" style="background:${t.color}"></div>
      <div class="th-inner">
        <div class="th-emoji" style="background:${t.color}18">${t.emoji}</div>
        <div class="th-info">
          <div class="th-name">${esc(t.label)}</div>
          <div class="th-desc">${esc(t.description)}</div>
        </div>
        <div class="ring-wrap" aria-hidden="true">
          <svg width="38" height="38" viewBox="0 0 38 38">
            <circle class="ring-bg" cx="19" cy="19" r="15" stroke-width="3"/>
            <circle class="ring-fill" cx="19" cy="19" r="15" stroke-width="3" stroke="${t.color}" stroke-dasharray="${da}" stroke-dashoffset="${off}"/>
          </svg>
          <div class="ring-pct">${pct}%</div>
        </div>
      </div>
    </button>`;
  }).join("");

  const resetBtn = totalSeen>0
    ? `<button class="btn-res link" onclick="resetAll()" style="margin-top:12px;font-size:13px">Voortgang verwijderen</button>` : "";

  return `<div class="home">
    <div class="home-hd">
      <div class="home-eyebrow">Oefening</div>
      <div class="home-title">Woordenschat Quiz</div>
      <div class="home-sub">Kies een thema en raad de betekenis op basis van voorbeeldzinnen ‚Äî geen vertalingen.</div>
    </div>
    <div class="stats-bar">
      <div class="stat-box"><div class="stat-val">${totalSeen}</div><div class="stat-lbl">Gezien</div></div>
      <div class="stat-box"><div class="stat-val">${totalCorrect}</div><div class="stat-lbl">Correct</div></div>
      <div class="stat-box"><div class="stat-val">${done}/${THEMES.length}</div><div class="stat-lbl">Klaar</div></div>
    </div>
    <div class="sec-label">Alle thema's</div>
    <nav class="theme-grid" aria-label="Themakeuze">${cards}</nav>
    ${resetBtn}
    <div class="kbd-row" style="margin-top:16px">
      <span class="kh"><span class="kbd">Tab</span> navigeren</span>
      <span class="kh"><span class="kbd">Enter</span> selecteren</span>
    </div>
  </div>`;
}

/* ‚îÄ‚îÄ COUNT SELECT ‚îÄ‚îÄ */
function renderCountSelect() {
  const t = THEMES.find(x=>x.id===S.pendingTheme);
  if(!t) return renderHome();
  const total = themeWordCount(t.id);
  const isLoading = !Q_CACHE[t.id];

  const countBtns = isLoading
    ? `<div class="loading" style="flex:0;padding:24px 0;gap:10px"><div class="spinner"></div><div style="font-size:14px">Woorden laden...</div></div>`
    : `<div class="count-grid">
        ${total>=10?`<button class="count-btn" id="count-10" onclick="startQuiz('${t.id}',10)">10<span>vragen</span></button>`:""}
        ${total>=20?`<button class="count-btn" onclick="startQuiz('${t.id}',20)">20<span>vragen</span></button>`:""}
        ${total>=40?`<button class="count-btn" onclick="startQuiz('${t.id}',40)">40<span>vragen</span></button>`:""}
        <button class="count-btn full" onclick="startQuiz('${t.id}','all')">
          Alles <span>alle ${total} vragen</span>
        </button>
      </div>`;

  return `<div class="count-sel">
    <div class="count-theme-badge" style="color:${t.color};border-color:${t.color}28;background:${t.color}10">
      ${t.emoji} ${esc(t.label)}
    </div>
    <div class="count-title">Hoeveel vragen?</div>
    <div class="count-sub">Woorden worden elke sessie opnieuw gerandomiseerd.</div>
    ${countBtns}
    <button class="back-btn-sm" onclick="goHome()">‚Üê Terug naar thema's</button>
  </div>`;
}

/* ‚îÄ‚îÄ QUIZ ‚îÄ‚îÄ */
function renderQuiz() {
  const t = THEMES.find(x=>x.id===S.theme);
  const q = S.questions[S.qIdx];
  const total = S.questions.length;
  const done = S.qIdx + (S.answered?1:0);
  const pct = (done/total*100).toFixed(1);

  const exHtml = (q.examples||[]).map((ex,i)=>{
    const hidden = i>0&&!S.ctxExpanded?" hidden":"";
    return `<div class="ctx-ex${hidden}"><span class="ctx-num">${i+1}</span>${safeEx(ex)}</div>`;
  }).join("");
  const extra = Math.max(0,(q.examples||[]).length-1);
  const expandBtn = extra>0
    ? `<button class="ctx-more ${S.ctxExpanded?"open":""}" onclick="toggleCtx()" aria-expanded="${S.ctxExpanded}">
        <span class="ctx-chevron">‚ñæ</span>
        <span>${S.ctxExpanded?"Minder tonen":extra+" zin"+(extra!==1?"nen":"")+" meer"}</span>
       </button>` : "";

  const optsHtml = q.options.map((opt,i)=>{
    let cls="option-btn";
    if(S.answered){
      cls+=" locked";
      if(i===q.correct&&S.answered==="ok"&&i===S.selectedIdx) cls+=" is-correct";
      if(i===q.correct&&S.answered==="bad") cls+=" show-correct";
      if(i===S.selectedIdx&&S.answered==="bad") cls+=" is-wrong";
    }
    return `<button class="${cls}" id="option-${i}" onclick="selectAnswer(${i})"${S.answered?' tabindex="-1"':''}>
      <span class="opt-key">${KEYS[i]}</span><span class="opt-txt">${esc(opt)}</span>
    </button>`;
  }).join("");

  let fbHtml="";
  if(S.answered){
    const ok=S.answered==="ok";
    const lbl=ok?"‚úì Goed gedaan!":"‚úó Niet helemaal.";
    const body=ok?esc(q.explanation):`<strong>Correct antwoord:</strong> ${esc(q.options[q.correct])}<br><br>${esc(q.explanation)}`;
    fbHtml=`<div class="feedback ${ok?"ok":"no"}" role="alert"><div class="fb-lbl">${lbl}</div><div class="fb-body">${body}</div></div>`;
  }

  const hintDisabled = !!S.answered;
  const hintBtn = `<button class="hint-btn ${S.showHint?"open":""}" id="hint-btn" onclick="toggleHint()" aria-expanded="${S.showHint}" ${hintDisabled?"disabled":""}>
    <span>üí°</span><span>Aanwijzing</span><span class="h-chev">‚ñæ</span>
  </button>`;
  let hintPop="";
  if(S.showHint&&!hintDisabled){
    hintPop=`<div class="hint-overlay" onclick="toggleHint()"></div>
      <div class="hint-pop" role="region" aria-label="Aanwijzing">
        <div class="hint-pop-hd">
          <div class="hint-pop-lbl"><span>üí°</span> Aanwijzing</div>
          <button class="hint-close" onclick="toggleHint()" id="hint-close" aria-label="Sluiten">‚úï</button>
        </div>${esc(q.hint)}</div>`;
  }

  const isLast = S.qIdx>=total-1;
  const nextLbl = isLast&&S.answered?"Resultaten bekijken":"Volgende ‚Üí";

  return `<div class="quiz">
    <div class="quiz-top">
      <div class="quiz-nav">
        <button class="nav-back" onclick="goHome()" aria-label="Terug naar thema's">‚Üê</button>
        <div class="quiz-theme-lbl" style="color:${t.color}">${t.emoji} ${esc(t.label)}</div>
        <div class="quiz-ctr" aria-label="Voortgang">${S.qIdx+1} / ${total}</div>
      </div>
      <div class="prog-wrap">
        <div class="prog-bar" role="progressbar" aria-valuenow="${pct}" aria-valuemin="0" aria-valuemax="100">
          <div class="prog-fill" style="width:${pct}%;background:${t.color}"></div>
        </div>
        <div class="score-pills" aria-label="Score">
          <div class="spill ok" aria-label="${S.scoreOk} goed"><span class="dot"></span>${S.scoreOk}</div>
          <div class="spill no" aria-label="${S.scoreBad} fout"><span class="dot"></span>${S.scoreBad}</div>
        </div>
      </div>
    </div>
    <div class="quiz-body">
      <div class="ctx">
        <div class="ctx-hd">
          <div class="ctx-hd-lbl"><span class="ctx-hd-dot"></span>IN CONTEXT</div>
          <div class="ctx-hd-ct">${(q.examples||[]).length} ${(q.examples||[]).length===1?"zin":"zinnen"}</div>
        </div>
        <div class="ctx-list">${exHtml}</div>
        ${expandBtn}
      </div>
      <div>
        <div class="q-lbl">WAT BETEKENT DIT WOORD?</div>
        <div class="q-word">${esc(q.word)}</div>
        <div class="q-pos">${esc(q.pos)}</div>
        <div class="options" role="group" aria-label="Antwoordopties">${optsHtml}</div>
      </div>
      ${fbHtml}
    </div>
    <div class="quiz-foot">
      <div class="kbd-row">
        <span class="kh"><span class="kbd">A</span><span class="kbd">B</span><span class="kbd">C</span><span class="kbd">D</span> kies</span>
        <span class="kh"><span class="kbd">H</span> aanwijzing</span>
        <span class="kh"><span class="kbd">Enter</span> volgende</span>
        <span class="kh"><span class="kbd">Esc</span> terug</span>
      </div>
      ${hintPop}
      <div class="foot-row">
        ${hintBtn}
        <button class="btn-next ${S.answered?"primary":"disabled"}" id="btn-next" onclick="nextQ()"
          ${!S.answered?'tabindex="-1" aria-disabled="true"':''}>${nextLbl}</button>
      </div>
    </div>
  </div>`;
}

/* ‚îÄ‚îÄ RESULTS ‚îÄ‚îÄ */
function renderResults() {
  const t = THEMES.find(x=>x.id===S.theme);
  const total = S.questions.length;
  const pct = Math.round(S.scoreOk/total*100);
  let emoji="üéâ",msg="Uitstekend! Je beheerst dit thema goed.";
  if(pct<50){emoji="üìö";msg="Blijf oefenen! Herhaling is de sleutel.";}
  else if(pct<70){emoji="üí™";msg="Goed bezig! Nog een paar rondes en je hebt het.";}
  else if(pct<90){emoji="üåü";msg="Heel goed! Je bent er bijna.";}
  const revBtn = S.wrongAnswers.length
    ? `<button class="btn-res secondary" id="btn-review" onclick="toggleReview()">Fouten bekijken (${S.wrongAnswers.length})</button>` : "";
  return `<div class="results">
    <div class="res-emoji">${emoji}</div>
    <div class="res-score" style="color:${t.color}">${pct}%</div>
    <div class="res-lbl">${S.scoreOk} van ${total} goed</div>
    <div class="res-msg">${msg}</div>
    <div class="res-stats">
      <div class="rs"><div class="rs-val g">${S.scoreOk}</div><div class="rs-lbl">Goed</div></div>
      <div class="rs"><div class="rs-val r">${S.scoreBad}</div><div class="rs-lbl">Fout</div></div>
      <div class="rs"><div class="rs-val" style="color:${t.color}">${total}</div><div class="rs-lbl">Totaal</div></div>
    </div>
    <div class="res-actions">
      <button class="btn-res primary" id="btn-retry" onclick="openCountSelect('${S.theme}')">Opnieuw proberen</button>
      ${revBtn}
      <button class="btn-res link" onclick="goHome()">‚Üê Terug naar thema's</button>
    </div>
    <div class="kbd-row" style="display:flex;margin-top:16px">
      <span class="kh"><span class="kbd">Enter</span> opnieuw</span>
      <span class="kh"><span class="kbd">Esc</span> terug</span>
    </div>
  </div>`;
}

/* ‚îÄ‚îÄ REVIEW ‚îÄ‚îÄ */
function renderReview() {
  const cards = S.wrongAnswers.map((w,i)=>
    `<div class="rev-card">
      <div class="rev-word">${i+1}. ${esc(w.word)}</div>
      <div class="rev-body">
        <span class="rev-wrong">Jouw antwoord: ${esc(w.selected)}</span><br>
        <strong>Correct: ${esc(w.correct)}</strong><br>${esc(w.explanation)}
      </div>
    </div>`).join("");
  return `<div class="review">
    <div class="rev-hd">
      <button class="nav-back" id="rev-back" onclick="toggleReview()">‚Üê</button>
      <div class="rev-title">Foute antwoorden (${S.wrongAnswers.length})</div>
    </div>
    ${cards}
    <div style="padding:16px 0">
      <button class="btn-res primary" onclick="openCountSelect('${S.theme}')" style="width:100%">Opnieuw proberen</button>
    </div>
  </div>`;
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   KEYBOARD NAVIGATION
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
document.addEventListener("keydown", e=>{
  const key = e.key.toLowerCase();
  if(S.screen==="quiz"){
    if(key in KEY_MAP&&!S.answered){e.preventDefault();selectAnswer(KEY_MAP[key]);return;}
    if((key==="enter"||key===" ")&&S.answered){
      const a=document.activeElement;
      if(!a||a===document.body||a.id==="btn-next"){e.preventDefault();nextQ();return;}
    }
    if(key==="h"&&!S.answered){e.preventDefault();toggleHint();return;}
    if(key==="escape"){e.preventDefault();S.showHint?toggleHint():goHome();return;}
    if((key==="arrowdown"||key==="arrowup")&&!S.answered){
      e.preventDefault();
      const opts=document.querySelectorAll(".option-btn:not(.locked)");
      if(!opts.length)return;
      let ci=-1;opts.forEach((o,i)=>{if(o===document.activeElement)ci=i;});
      ci=key==="arrowdown"?(ci+1)%opts.length:(ci-1+opts.length)%opts.length;
      opts[ci].focus();return;
    }
  }
  if(S.screen==="home"){
    if(key==="arrowdown"||key==="arrowup"){
      e.preventDefault();
      const cards=document.querySelectorAll(".theme-card");
      let ci=-1;cards.forEach((c,i)=>{if(c===document.activeElement)ci=i;});
      ci=key==="arrowdown"?(ci+1)%cards.length:(ci-1+cards.length)%cards.length;
      cards[ci].focus();
    }
  }
  if(S.screen==="count-select"&&key==="escape"){e.preventDefault();goHome();}
  if(S.screen==="results"){
    if(key==="enter"){const a=document.activeElement;if(!a||a===document.body){e.preventDefault();openCountSelect(S.theme);}}
    if(key==="escape"){e.preventDefault();S.showReview?toggleReview():goHome();}
  }
});

/* ‚ïê‚ïê BOOT ‚ïê‚ïê */
render();
</script>
</body>
</html>
